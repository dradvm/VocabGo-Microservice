generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model auth_providers {
  id               String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  auth_user_id     String     @db.Uuid
  provider         String     @db.VarChar(50)
  provider_user_id String     @db.VarChar(255)
  email            String?    @db.VarChar(255)
  display_name     String?    @db.VarChar(255)
  avatar_url       String?
  linked_at        DateTime?  @default(now()) @db.Timestamptz(6)
  auth_users       auth_users @relation(fields: [auth_user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([provider, provider_user_id])
  @@index([auth_user_id], map: "idx_auth_providers_user")
}

model auth_sessions {
  id            String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  auth_user_id  String     @db.Uuid
  device_info   String?    @db.VarChar(255)
  user_agent    String?
  ip_address    String?    @db.Inet
  refresh_token String     @unique(map: "unique_refresh_token")
  is_revoked    Boolean?   @default(false)
  expires_at    DateTime   @db.Timestamptz(6)
  created_at    DateTime?  @default(now()) @db.Timestamptz(6)
  last_used_at  DateTime?  @db.Timestamptz(6)
  auth_users    auth_users @relation(fields: [auth_user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([auth_user_id], map: "idx_auth_sessions_user")
  @@index([refresh_token], map: "idx_auth_sessions_refresh_hash")
}

model auth_users {
  id             String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  username       String?          @unique @db.VarChar(50)
  primary_email  String?          @unique @db.VarChar(255)
  password_hash  String?
  role           String?          @default("user") @db.VarChar(20)
  status         String?          @default("active") @db.VarChar(20)
  created_at     DateTime?        @default(now()) @db.Timestamptz(6)
  updated_at     DateTime?        @default(now()) @db.Timestamptz(6)
  last_login_at  DateTime?        @db.Timestamptz(6)
  auth_providers auth_providers[]
  auth_sessions  auth_sessions[]

  @@index([primary_email], map: "idx_auth_users_email")
}
